(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[35],{"72k+":function(e,t,a){"use strict";var l=a("tAuX"),n=a("g09b");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("Pwec");var u=n(a("CtXQ"));a("5Dmo");var d=n(a("3S7+"));a("T2oS");var i=n(a("W9HT"));a("jCWc");var r=n(a("kPKH"));a("14J3");var s=n(a("BMrR")),o=n(a("p0pE")),c=n(a("gWZ8")),f=n(a("qIgq")),m=l(a("q1tI")),g=a("Y2fQ"),v=n(a("vTut")),h=n(a("ZhIB")),p=n(a("CLrh")),y=n(a("wd/R")),b=a("N8P2"),E=v.default.ChartCard,M=v.default.MiniArea,D=v.default.MiniBar,j=v.default.Field,k=v.default.Line,w=0,S=0,O={xs:24,sm:12,md:12,lg:12,xl:6,style:{marginBottom:24}};function C(e){var t=e.loading,a=e.visitData,l={cpu2:[],jvm:[],messageData:[],sameDay:0,month:0,metadata:{},eventData:[]},n=(0,m.useState)(l.cpu2),v=(0,f.default)(n,2),C=v[0],Y=v[1],T=(0,m.useState)(l.jvm),F=(0,f.default)(T,2),q=F[0],H=F[1],A=(0,m.useState)(l.sameDay),N=(0,f.default)(A,2),P=N[0],x=N[1],B=(0,m.useState)(l.month),W=(0,f.default)(B,2),I=W[0],J=W[1],R=(0,m.useState)(l.month),L=(0,f.default)(R,2),Q=L[0],X=L[1],Z=(0,m.useState)(l.month),_=(0,f.default)(Z,2),K=_[0],U=_[1],z=(0,m.useState)(l.month),G=(0,f.default)(z,2),V=G[0],$=G[1],ee=(0,m.useState)(l.messageData),te=(0,f.default)(ee,1),ae=te[0],le=(0,m.useState)(!0),ne=(0,f.default)(le,2),ue=ne[0],de=ne[1],ie=(0,m.useState)(!0),re=(0,f.default)(ie,2),se=re[0],oe=re[1],ce=function(){var e=new Date;e.setDate(e.getDate()-30);var t=e.getFullYear(),a=e.getMonth()+1<10?"0".concat(e.getMonth()+1):e.getMonth()+1,l=e.getDate()<10?"0".concat(e.getDate()):e.getDate();return"".concat(t,"-").concat(a,"-").concat(l," 00:00:00")},fe=function(){var e=[{dashboard:"device",object:"message",measurement:"quantity",dimension:"agg",group:"sameDay",params:{time:"1d",format:"yyyy-MM-dd"}},{dashboard:"device",object:"message",measurement:"quantity",dimension:"agg",group:"sameMonth",params:{limit:30,time:"1d",format:"yyyy-MM-dd",from:ce()}},{dashboard:"device",object:"message",measurement:"quantity",dimension:"agg",group:"month",params:{time:"1M",format:"yyyy-MM-dd",from:ce()}}];p.default.analysis.getMulti(e).then(function(e){var t=null===e||void 0===e?void 0:e.result;200===e.status&&t.forEach(function(e){switch(e.group){case"sameDay":x(e.data.value);break;case"month":J(e.data.value);break;case"sameMonth":ae.push({x:(0,y.default)(new Date(e.data.timeString)).format("YYYY-MM-DD"),y:Number(e.data.value)});break;default:break}}),oe(!1)})},me=function(){var e=[{dashboard:"device",object:"status",measurement:"record",dimension:"current",group:"deviceOnline",params:{state:"online"}},{dashboard:"device",object:"status",measurement:"record",dimension:"current",group:"deviceCount"},{dashboard:"device",object:"status",measurement:"record",dimension:"current",group:"deviceNotActive",params:{state:"notActive"}},{dashboard:"device",object:"status",measurement:"record",dimension:"aggOnline",group:"aggOnline",params:{limit:20,time:"1d",format:"yyyy-MM-dd"}}];p.default.analysis.getMulti(e).then(function(e){var t=null===e||void 0===e?void 0:e.result;200===e.status&&t.forEach(function(e){switch(e.group){case"aggOnline":a.push({x:(0,y.default)(new Date(e.data.timeString)).format("YYYY-MM-DD"),y:Number(e.data.value)});break;case"deviceOnline":X(e.data.value);break;case"deviceCount":U(e.data.value);break;case"deviceNotActive":$(e.data.value);break;default:break}}),de(!1)})};return(0,m.useEffect)(function(){me(),fe();var e=(0,b.getWebsocket)("home-page-statistics-cpu-realTime","/dashboard/systemMonitor/cpu/usage/realTime",{params:{history:1}}).subscribe(function(e){var t=e.payload,a=t.value;if(a)try{C[0]&&C.map(function(e){return e.label=!1}),q[0]&&q.map(function(e){return e.label=!1});var l=(new Date).valueOf();w++,11===w?(C.splice.apply(C,[0,C.length].concat((0,c.default)(C.filter(function(e){return e.updateTime!==S})))),q.splice.apply(q,[0,q.length].concat((0,c.default)(q.filter(function(e){return e.updateTime!==S})))),S=Object.values(C)[0].updateTime,w--):1===w&&(S=l),Object.keys(a).forEach(function(e){a[e].updateTime=l,C.push((0,o.default)({},a[e],{type:e,value:a[e]["cpu-load"],label:!0})),q.push((0,o.default)({},a[e],{type:e,value:a[e]["nc-load"],label:!0}))}),Y((0,c.default)(C)),H((0,c.default)(q))}catch(e){console.log(e)}});return function(){w=0,e&&e.unsubscribe()}},[]),m.default.createElement(s.default,{gutter:24},m.default.createElement(r.default,Object.assign({},O),m.default.createElement(i.default,{spinning:ue},m.default.createElement(E,{bordered:!1,title:"\u5f53\u524d\u5728\u7ebf",action:m.default.createElement(d.default,{title:"\u5237\u65b0"},m.default.createElement(u.default,{type:"sync",onClick:function(){de(!0),me()}})),total:(0,h.default)(Q).format("0,0"),footer:m.default.createElement("div",{style:{whiteSpace:"nowrap",overflow:"hidden"}},m.default.createElement(j,{style:{marginRight:40,float:"left"},label:m.default.createElement(g.FormattedMessage,{id:"analysis.analysis.device-total",defaultMessage:"\u8bbe\u5907\u603b\u91cf"}),value:(0,h.default)(K).format("0,0")}),m.default.createElement(j,{label:m.default.createElement(g.FormattedMessage,{id:"analysis.analysis.device-activation",defaultMessage:"\u672a\u6fc0\u6d3b\u8bbe\u5907"}),value:(0,h.default)(V).format("0,0")})),contentHeight:46},m.default.createElement(D,{data:a})))),m.default.createElement(r.default,Object.assign({},O),m.default.createElement(i.default,{spinning:se},m.default.createElement(E,{bordered:!1,loading:t,title:m.default.createElement(g.FormattedMessage,{id:"analysis.analysis.device-day-visits",defaultMessage:"\u65e5\u8bbf\u6d88\u606f\u91cf"}),action:m.default.createElement(d.default,{title:"\u5237\u65b0"},m.default.createElement(u.default,{type:"sync",onClick:function(){oe(!0),fe()}})),total:(0,h.default)(P).format("0,0"),footer:m.default.createElement(j,{label:m.default.createElement(g.FormattedMessage,{id:"analysis.analysis.device-visits",defaultMessage:"\u5f53\u6708\u8bbe\u5907\u6d88\u606f\u91cf"}),value:(0,h.default)(I).format("0,0")}),contentHeight:46},m.default.createElement(M,{color:"#975FE4",data:ae})))),m.default.createElement(r.default,Object.assign({},O),m.default.createElement(i.default,{spinning:0===C.length},m.default.createElement(E,{loading:t,bordered:!1,title:"CPU\u4f7f\u7528\u7387",contentHeight:120},C[0]?m.default.createElement(k,{height:130,list:C,unit:"%"}):m.default.createElement("div",{style:{height:120}})))),m.default.createElement(r.default,Object.assign({},O),m.default.createElement(i.default,{spinning:0===q.length},m.default.createElement(E,{loading:t,bordered:!1,title:"\u5185\u5b58\u4f7f\u7528\u7387",contentHeight:120},q[0]?m.default.createElement(k,{height:130,list:q,unit:"%"}):m.default.createElement("div",{style:{height:120}})))))}var Y=C;t.default=Y}}]);